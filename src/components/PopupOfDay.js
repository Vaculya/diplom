import Popup from"./Popup.js";export default class extends Popup{constructor(n,t,i){super(n);this._dataDays=t;this._thisDay=i;this._form=this._popupSelector.querySelector(".popup__form");this._cardCreaterBtnToSave=this._popupSelector.querySelector(".card-creater__save");this._cardCreaterImagesWrapper=this._popupSelector.querySelector(".card-creater__images-wrapper");this._cardCreaterText=this._form.querySelector(".card-creater__text");this._cardCreaterInputWraperImg=this._form.querySelector(".card-creater__images-wrapper-input");this._cardCreaterInputImages=this._cardCreaterInputWraperImg.querySelector(".card-creater__img");this._cardCreaterChooseBtn=this._cardCreaterInputWraperImg.querySelector(".card-creater__img-add");this._cardCreaterDay=this._popupSelector.querySelector(".card-creater__day")}open(){super.open();console.log(this._files);this._cardCreaterDay.textContent=this._thisDay;this._cardCreaterInputImages.value="";this._cardCreaterText.value="";this._cardCreaterImagesWrapper.innerHTML="";this._cardCreaterImagesWrapper.classList.remove("card-creater__images-wrapper_opened");Object.keys(this._dataDays[this._cardCreaterDay.textContent]).length!==0&&(this._cardCreaterText.value=this._dataDays[this._cardCreaterDay.textContent].text,this._dataDays[this._cardCreaterDay.textContent].images!==undefined&&this._dataDays[this._cardCreaterDay.textContent].images.length!==0&&(this._cardCreaterImagesWrapper.innerHTML="",this._cardCreaterImagesWrapper.classList.add("card-creater__images-wrapper_opened"),console.log(this._dataDays),console.log(this._dataDays[this._cardCreaterDay.textContent]),console.log(this._dataDays[this._cardCreaterDay.textContent].images),this._images=this._dataDays[this._cardCreaterDay.textContent].images,console.log("Фото этого дня = "+this._images),this._dataDays[this._cardCreaterDay.textContent].images.forEach(n=>{this._reader=new FileReader,this._reader.onload=t=>{console.log(n),console.log(t),this._cardCreaterImagesWrapper.insertAdjacentHTML("afterbegin",`
              <div class="card-creater__preview-boxImg">
                <div class="card-creater__preview-remove">&times;</div>
                <img class="card-creater__preview-image" src='${t.target.result}' alt="${n.name}"/>
              </div>
              `)},this._reader.readAsDataURL(n)})))}close(){super.close();this._cardCreaterChooseBtn.removeEventListener("click",n=>{n.preventDefault(),this._trigerInput()});this._form.reset()}setEventListeners(){super.setEventListeners();this._cardCreaterBtnToSave.addEventListener("click",()=>{this._saveDayDatas()});this._cardCreaterInputImages.addEventListener("change",n=>{console.log("Изменено"),this._readFiles(n)});this._cardCreaterImagesWrapper.addEventListener("click",n=>{this._deleteCard(n)})}_deleteCard(n){if(n.target.classList.contains("card-creater__preview-remove")){if(this._name=n.target.nextElementSibling.alt,console.log(this._name),this._files!==undefined&&this._files.forEach(n=>{n.name===this._name&&(this._files=this._files.filter(n=>n.name!==this._name))}),this._dataDays[this._cardCreaterDay.textContent].hasOwnProperty("images")&&this._dataDays[this._cardCreaterDay.textContent].images.length!==0){console.log(this._dataDays[this._cardCreaterDay.textContent].images);const n=this._dataDays[this._cardCreaterDay.textContent].images.findIndex(n=>n.name==this._name);console.log(n);n!==-1&&(this._dataDays[this._cardCreaterDay.textContent].images.splice(n,1),console.log("Удалил"))}return console.log(this._dataDays[this._cardCreaterDay.textContent]),console.log(this._files),this._block=n.target.closest(".card-creater__preview-boxImg"),this._block.classList.add("card-creater__preview-boxImg_removing"),setTimeout(()=>{this._block.remove(),console.log("что-о"),this._cardCreaterImagesWrapper.children.length==0&&this._cardCreaterImagesWrapper.classList.remove("card-creater__images-wrapper_opened")},300),this._dataDays[this._cardCreaterDay.textContent]}}_readFiles(n){n.target.files.length&&(this._files=Array.from(n.target.files))}_saveDayDatas(){return this._cardCreaterInputImages.value===""&&this._files===undefined?(this._files=this._images,this._dataDays[this._cardCreaterDay.textContent]={text:this._cardCreaterText.value,images:this._files}):this._dataDays[this._cardCreaterDay.textContent]={text:this._cardCreaterText.value,images:this._files},console.log(this._files),super.close(),this._dataDays}};